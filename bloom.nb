(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[      4780,        148]
NotebookOptionsPosition[      4526,        134]
NotebookOutlinePosition[      4880,        150]
CellTagsIndexPosition[      4837,        147]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"file", "=", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<raw.rgb\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lumenMatrix", "=", 
   RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ColorConvert", "[", 
       RowBox[{"#", ",", "\"\<Grayscale\>\""}], "]"}], "&"}], 
     "\[IndentingNewLine]", "/@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"nx", ",", "ny", ",", "ns"}], "}"}], "=", 
   RowBox[{"ReadList", "[", 
    RowBox[{
     RowBox[{"\"\<!head -n2 \>\"", "<>", "file"}], ",", "\"\<Number\>\""}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pixels", "=", 
   RowBox[{"ArrayReshape", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"BinaryReadList", "[", 
       RowBox[{
        RowBox[{"\"\<!gtail -n+3 \>\"", "<>", "file"}], ",", 
        "\"\<Real64\>\""}], "]"}], "/", "ns"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"nx", "*", "ny"}], ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gs", "=", 
   RowBox[{"pixels", ".", "lumenMatrix"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"maxgray", "=", 
   RowBox[{"Max", "[", "gs", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"threshed", "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"#", ">", "1"}], ",", "#", ",", "0"}], "]"}], "&"}], "/@", 
     "gs"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plt", "[", "a_", "]"}], ":=", 
   RowBox[{"Image", "[", 
    RowBox[{"Raster", "[", "a", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rs", "[", "a_", "]"}], ":=", 
   RowBox[{"ArrayReshape", "[", 
    RowBox[{"a", ",", 
     RowBox[{"{", 
      RowBox[{"nx", ",", "ny"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rs3", "[", "a_", "]"}], ":=", 
   RowBox[{"ArrayReshape", "[", 
    RowBox[{"a", ",", 
     RowBox[{"{", 
      RowBox[{"nx", ",", "ny", ",", "3"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"im", "=", 
   RowBox[{"plt", "[", 
    RowBox[{"rs3", "[", "pixels", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tim", "=", 
   RowBox[{"plt", "[", 
    RowBox[{"rs", "[", "threshed", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"blurred", "=", 
   RowBox[{"GaussianFilter", "[", 
    RowBox[{"tim", ",", "5"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bla", "=", 
   RowBox[{"ImageData", "[", "blurred", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Image", "[", 
  RowBox[{"Sqrt", "[", 
   RowBox[{"ImageData", "[", 
    RowBox[{"ImageAdd", "[", 
     RowBox[{"im", ",", "blurred"}], "]"}], "]"}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.672813654265861*^9, 3.67281386768086*^9}, {
   3.672813898818322*^9, 3.6728139278943777`*^9}, {3.672813960062765*^9, 
   3.6728139725804853`*^9}, {3.672814036020288*^9, 3.672814172439394*^9}, {
   3.672814205405388*^9, 3.672814227005083*^9}, {3.672814564306821*^9, 
   3.6728146573704157`*^9}, {3.672814711203638*^9, 3.672814765847787*^9}, {
   3.6728148638758802`*^9, 3.672814901169351*^9}, {3.672814963103107*^9, 
   3.672814985248069*^9}, {3.672815046078991*^9, 3.672815078426659*^9}, {
   3.672815193617526*^9, 3.672815193743864*^9}, {3.672815255557266*^9, 
   3.6728152777878523`*^9}, {3.672815321651887*^9, 3.6728154357257957`*^9}, 
   3.6728155327005653`*^9, 3.6728169532732983`*^9}]
},
WindowSize->{740, 755},
WindowMargins->{{4, Automatic}, {Automatic, 4}},
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (January 25, \
2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 3965, 112, 335, "Input"]
}
]
*)

(* End of internal cache information *)
